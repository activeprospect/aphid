<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="cache-control" content="no-cache" />
    <title>Aphid.UI.View Tests</title>
    <link rel="stylesheet" href="../../../Build/Resources/Stylesheets/Aphid.css" />
    <link rel="stylesheet" href="../../Tests.css" />
    <script src="../../../Build/Library/Aphid.Combined.js"></script>
    <script src="../../../Vendor/script.aculo.us/src/unittest.js"></script>
  </head>
  <body class="testCase">

    <header>
      <h1>Aphid.UI.View Tests</h1>
    </header>

    <!-- Test Case Description -->
    <section id="descriptionSection">
      <p>
        Ensures that the Aphid.UI.View class can be initialized from static
        HTML elements, by asynchronously loading templates and as a result of
        outlets in the document or loaded templates.
      </p>
    </section>

    <!-- Test Elements -->
    <section id="testElements">
      <section id="testElement"></section>
      <section id="testElementWithOutlet">
        <section id="testElementWithOutletTestOutlet" data-outlet="testOutlet"></section>
      </section>
      <section id="testOutlet" data-outlet="testOutlet"></section>
      <section id="testOutletWithOutlet" data-outlet="parentOutlet">
        <section id="testOutletWithOutletChildOutlet" data-outlet="testOutlet"></section>
      </section>
      <section id="testElementWithOutletWithViewClass">
        <section id="testOutletWithViewClass" data-outlet="testOutlet" data-view-class="AnotherTestView"></section>
      </section>
      <section id="testElementWithOutletWithCustomProperties">
        <section id="testOutletWithCustomProperties" data-outlet="testOutlet" data-view-class="TestViewWithProperties" data-custom-property="foo" data-true-property="true" data-false-property="false"></section>
      </section>
      <section id="testElementWithDisabledClassName" class="disabled">
      </section>
    </section>

    <!-- Log Section -->
    <section id="logSection">
    </section>

    <!-- Tests -->
    <script>

      var TestView;
      var AnotherTestView;
      var TestViewWithProperties;
      var TestViewWithCallbacks;
      var TestViewWithSubviews;

      new Test.Unit.Runner({

        setup: function() { with(this) {
          $AppDelegate.baseViewPath = "../../Fixtures/Templates";
          TestView = Class.create(Aphid.UI.View, {
            displayName: "TestView",
            testOutlet: false
          });
          AnotherTestView = Class.create(Aphid.UI.View, {
            displayName: "AnotherTestView"
          });
          TestViewWithProperties = Class.create(Aphid.UI.View, {
            displayName: "TestViewWithProperties",
            customProperty: false,
            trueProperty: false,
            falseProperty: false
          });
          TestViewWithCallbacks = Class.create(Aphid.UI.View, {
            displayName: "TestViewWithCallbacks",

            viewWillAppearCalled: false,
            viewWillAppear: function(animated)
            {
              this.viewWillAppearCalled = true;
            },

            viewDidAppearCalled: false,
            viewDidAppear: function(animated)
            {
              this.viewDidAppearCalled = true;
            },

            viewWillDisappearCalled: false,
            viewWillDisappear: function(animated)
            {
              this.viewWillDisappearCalled = true;
            },

            viewDidDisappearCalled: false,
            viewDidDisappear: function(animated)
            {
              this.viewDidDisappearCalled = true;
            }

          });
          TestViewWithSubviews = Class.create(TestViewWithCallbacks, {
            displayName: "TestViewWithSubviews",
            viewDidLoad: function($super)
            {
              $super();
              this.addSubview(new TestViewWithCallbacks());
              this.addSubview(new TestViewWithCallbacks());
            }
          });
        }},

        /* Initialization Tests ------------------------------------------- */

        /*
         * Ensures that instances of Aphid.UI.View can be initialized and have
         * the expected default property values set after initialization.
        **/
        testShouldInitializeView: function() { with(this) {
          var view = new Aphid.UI.View();
          assertInstanceOf(Aphid.UI.View, view, "view should be an instance of Aphid.UI.View");
          assertInstanceOf(Array, view.subviews, "subviews should be an instance of Array");
          assertInstanceOf(Element, view.element, "element should be an instance of Element");
          assertEqual("section", view.tagName, "tagName should be equal to &quot;section&quot;");
          assert(view.isLoaded, "isLoaded should be false");
          assert(!view.isLoading, "isLoading should be false");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View with an empty element
         * can be initialized with a custom tag name.
        **/
        testShouldInitializeEmptyViewUsingTagName: function() { with(this) {
          var view = new Aphid.UI.View({ tagName: "ul" });
          assertInstanceOf(Element, view.element, "element should be an instance of Element");
          assertEqual("ul", view.tagName, "tagName should be equal to &quot;ul&quot;");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing an element to the constructor.
        **/
        testShouldInitializeViewFromElement: function() { with(this) {
          var view = new Aphid.UI.View({
            element: $('testElement')
          });
          assertEqual($('testElement'), view.element);
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the name of a template.
        **/
        testShouldInitializeViewFromTemplate: function() { with(this) {
          var view = new Aphid.UI.View({
            template: "TestTemplate"
          });
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
          assert(view.element, "element should not be false");
          assertEqual("testTemplate", view.element.identify());
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the name of a template. The view must load this template
         * asynchronously.
        **/
        testShouldInitializeViewAsynchronouslyFromTemplate: function() { with(this) {
          var view = new Aphid.UI.View({
            template: "TestTemplate",
            asynchronousLoadingEnabled: true
          });
          assert(!view.isLoaded, "isLoaded should be false");
          assert(view.isLoading, "isLoading should be true");
          wait(1000, function() { with(this) {
            assert(view.isLoaded, "isLoaded should be true");
            assert(!view.isLoading, "isLoading should be false");
            assert(view.element, "element should not be false");
            assertEqual("testTemplate", view.element.identify());
          }});
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the element that defines an outlet.
        **/
        testShouldInitializeViewFromOutlet: function() { with(this) {
          var view = new Aphid.UI.View({
            outlet: $('testOutlet')
          });
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
          assert(view.element, "element should not be false");
          assertEqual($('testOutlet'), view.element);
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized from an element.
        **/
        testShouldInitializeOutletFromElement: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutlet")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
          assertEqual("testElementWithOutletTestOutlet", view.testOutlet.element.identify());
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized from a template that was loaded
         * asynchronously.
        **/
        testShouldInitializeOutletFromTemplate: function() { with(this) {
          var view = new TestView({
            template: "TestTemplateWithOutlet"
          });
          wait(1000, function() { with(this) {
            assert(view.testOutlet, "testOutlet should not be false");
            assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
            assertEqual("testTemplateWithOutletTestOutlet", view.testOutlet.element.identify());
          }});
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized as an outlet of a parent view.
        **/
        testShouldInitializeOutletFromOutlet: function() { with(this) {
          var view = new TestView({
            outlet: $("testOutletWithOutlet")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
          assertEqual("testOutletWithOutletChildOutlet", view.testOutlet.element.identify());
        }},

        /*
         * Ensure that views that are initialized from an outlet have their
         * superview property set to the view that owns the outlet.
        **/
        testShouldSetSuperviewOnOutlet: function() { with(this) {
          var view = new TestView({
            outlet: $("testElementWithOutlet")
          });
          assert(view.testOutlet.superview, "testOutlet.superview should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet.superview, "testOutlet.superview should be an instance of Aphid.UI.View");
          assertEqual("testElementWithOutlet", view.testOutlet.superview.element.identify());
        }},

        /*
         * Ensure that views that are initialized from an outlet are added to
         * the subviews property of the view that owns the outlet.
        **/
        testShouldAddOutletToSuperviewsSubviews: function() { with(this) {
          var view = new TestView({
            outlet: $("testElementWithOutlet")
          });
          assertEqual(1, view.subviews.length, "view.subviews.length should be 1");
          assert(view.subviews.include(view.testOutlet));
        }},

        /*
         * Ensures that an outlet the defines the data-view-class attribute
         * for a custom class is actually initialized with the expected class.
        **/
        testShouldInitializeOutletWithViewClass: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithViewClass")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(AnotherTestView, view.testOutlet, "testOutlet should be an instance of AnotherTestView");
        }},

        /*
         * Ensure that views that are initialized from an outlet be
         * initialized with options specified as HTML5 data-* attributes.
        **/
        testShouldSetCustomPropertiesFromOutlet: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithCustomProperties")
          });
          assertEqual("foo", view.testOutlet.customProperty);
        }},

        /*
         * Ensure that views that are initialized from an outlet with boolean
         * HTML5 data-* attributes are properly cast to boolean values.
        **/
        testShouldCastCustomBooleanPropertiesFromOutlet: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithCustomProperties")
          });
          assertEqual(true, view.testOutlet.trueProperty);
          assertEqual(false, view.testOutlet.falseProperty);
        }},

        /*
         * Ensure that newly initialized views are enabled, by default.
        **/
        testShouldInitializeEnabledByDefault: function() { with(this) {
          var view = new TestView({
            element: $("testElement")
          });
          assert(view.isEnabled, "view#isEnabled should be true");
          assert(!view.element.hasClassName("disabled"), "view#element should not have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that views can be initialized in a disabled state.
        **/
        testShouldInitializeDisabled: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: false
          });
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that views that are initialized with an element that has the
         * "disabled" CSS class name are initialized in a disabled state.
        **/
        testShouldInitializeWithDisabledCSSClass: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithDisabledClassName")
          });
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that disabled views can be enabled and that the element
         * receives the "enabled" CSS class name upon enabling.
        **/
        testShouldEnableView: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: false
          });
          view.enable();
          assert(view.isEnabled, "view#isEnabled should be true");
          assert(!view.element.hasClassName("disabled"), "view#element should not have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that enabled views can be disabled and that the element
         * receives the "disabled" CSS class name upon disabling.
        **/
        testShouldDisableView: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: true
          });
          view.disable();
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},

        /* View Stack Tests ----------------------------------------------- */

        /**
         * Ensure that views may have their view set with a single subview
         * using the setView method.
        **/
        testShouldSetView: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.setView(subview);
          assertEqual(1, testView.subviews.length, "testView#subviews should have a length of 1");
          assertEqual(testView.subviews.first(), subview, "testView#subviews should include subview");
        }},

        /**
         * Ensure that views may have their view set with a single subview
         * using the setViewAnimated method.
        **/
        testShouldSetViewAnimated: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.setViewAnimated(subview);
          assertEqual(1, testView.subviews.length, "testView#subviews should have a length of 1");
          assertEqual(testView.subviews.first(), subview, "testView#subviews should include subview");
        }},

        /**
         * Ensure that subviews may be added to a view using the addSubview
         * method.
        **/
        testShouldAddSubview: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.addSubview(subview);
          assertEqual(1, testView.subviews.length, "testView#subviews should have a length of 1");
          assertEqual(testView.subviews.first(), subview, "testView#subviews should include subview");
        }},

        /**
         * Ensure that subviews may be added to a view using the
         * addSubviewAnimated method.
        **/
        testShouldAddSubviewAnimated: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.addSubviewAnimated(subview);
          assertEqual(1, testView.subviews.length, "testView#subviews should have a length of 1");
          assertEqual(testView.subviews.first(), subview, "testView#subviews should include subview");
        }},

        /**
         * Ensure that subviews may be removed from their superview by calling
         * the removeFromSuperview() method on the view to be removed.
        **/
        testShouldRemoveFromSuperview: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          firstSubview.removeFromSuperview();
          secondSubview.removeFromSuperview();
          assert(!firstSubview.get("superview"));
          assert(!secondSubview.get("superview"));
          assertEqual(0, testView.subviews, "testView#subviews should have no subviews");
        }},

        /**
         * Ensure that subviews may be removed from their superview by calling
         * the removeFromSuperviewAnimated() method on the view to be removed.
        **/
        testShouldRemoveFromSuperviewAnimated: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          firstSubview.removeFromSuperviewAnimated();
          secondSubview.removeFromSuperviewAnimated();
          assert(!firstSubview.get("superview"), "firstSubview should not have a superview");
          assert(!secondSubview.get("superview"), "secondSubview should not have a superview");
          assertEqual(0, testView.subviews, "testView#subviews should have no subviews");
        }},

        /**
         * Ensure that all subviews on a view may be removed at once by
         * calling the clearSubviews() method.
        **/
        testShouldClearSubviews: function() { with(this) {
          var testView = new TestViewWithSubviews();
          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          testView.clearSubviews();
          assertEqual(0, testView.subviews.length);
        }},

        // Action Tests ------------------------------------------------------

        // TODO Implement Action Tests...

        // Callback Tests ----------------------------------------------------

        /**
         * Ensure that setting the view with setView() calls the viewWillAppear
         * callback on the view to be set.
        **/
        testSetViewShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with setView");
          subview.viewWillAppearCalled = false;
        }},

        /**
         * Ensure that setting the view with setViewAnimated() calls the
         * viewWillAppear callback on the view to be set.
        **/
        testSetViewAnimatedShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          testView.setViewAnimated(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with setViewAnimated");
          subview.viewWillAppearCalled = false;
        }},

        /**
         * Ensure that adding a view width addSubview() calls the
         * viewWillAppear callback on the view to be added.
        **/
        testAddSubviewShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          testView.addSubview(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with addSubview");
          subview.viewWillAppearCalled = false;
        }},

        /**
         * Ensure that adding a view width addSubviewAnimated() calls the
         * viewWillAppear callback on the view to be added.
        **/
        testAddSubviewAnimatedShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          testView.addSubviewAnimated(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with addSubviewAnimated");
          subview.viewWillAppearCalled = false;
        }},

        /**
         * Ensure that setting the view with setView() calls the viewWillAppear
         * callback on each of the subviews on the view that is to be set.
        **/
        testSetViewShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setView");
        }},

        /**
         * Ensure that setting the view with setViewAnimated() calls the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be set.
        **/
        testSetViewAnimatedShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setViewAnimated(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setViewAnimated");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setViewAnimated");
        }},

        /**
         * Ensure that adding a view with addSubview() calls the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testAddSubviewShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.addSubview(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubview");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubview");
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() calls the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testAddSubviewAnimatedShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.addSubviewAnimated(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
        }},

        /**
         * Ensure that setting the view with setView() calls the viewDidAppear
         * callback on the view to be set.
        **/
        testSetViewShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with setView");
        }},

        /**
         * Ensure that setting the view with setViewAnimated() calls the
         * viewDidAppear callback on the view to be set.
        **/
        testSetViewAnimatedShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setViewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with setViewAnimated");
          }});
        }},

        /**
         * Ensure that adding a view width addSubview() calls the
         * viewDidAppear callback on the view to be added.
        **/
        testAddSubviewShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.addSubview(subview);
          assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with addSubview");
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() calls the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testAddSubviewAnimatedShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.addSubviewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with addSubviewAnimated");
          }});
        }},

        /**
         * Ensure that setting the view with setView() calls the viewDidAppear
         * callback on each of the subviews on the view that is to be added.
        **/
        testSetViewShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setView");
        }},

        /**
         * Ensure that setting the view with setViewAnimated() calls the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testSetViewAnimatedShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setViewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        /**
         * Ensure that adding a view with addSubview() calls the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testAddSubviewShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.addSubview(subview);
          assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubview");
          assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubview");
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() calls the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added.
        **/
        testAddSubviewAnimatedShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.addSubviewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
            assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
          }});
        }},

        testSetViewShouldCallViewWillDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setView();
          assert(subview.viewWillDisappearCalled, "viewWillDisappear should be called on the view when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewWillDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setViewAnimated(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.viewWillDisappearCalled, "viewWillDisappear should be called on the view when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewWillDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setView();
          assert(subview.get("subviews")[0].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewWillDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewDidDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setView();
          assert(subview.viewDidDisappearCalled, "viewDidDisappear should be called on the view when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewDidDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.viewDidDisappearCalled, "viewDidDisappear should be called on the view when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewDidDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setView();
          assert(subview.get("subviews")[0].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewDidDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        /**
         * Ensure that when setting a subview with setView() that the subview
         * is not removed from the superview if the subview is already a
         * subview of the superview.
        **/
        testSetViewShouldNotAttemptToAddPassedViewIfAlreadyASubview: function() { with(this) {
          var testView   = new TestViewWithSubviews(),
              firstView  = testView.get("subviews")[0],
              secondView = testView.get("subviews")[1];

          firstView.set("viewWillAppearCalled", false);
          firstView.set("viewDidAppearCalled", false);
          firstView.set("viewWillDisappearCalled", false);
          firstView.set("viewDidDisappearCalled", false);

          testView.setView(firstView);

          assert(!firstView.get("viewWillAppearCalled"), "viewWillAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidAppearCalled"), "viewDidAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewWillDisappearCalled"), "viewWillDisappear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidDisappearCalled"), "viewDidDisappear should not have been called on firstView, since it was already a subview of testView");
        }},

        /**
         * Ensure that when setting a subview with setView() that the subview
         * is not removed from the superview if the subview is already a
         * subview of the superview.
        **/
        testSetViewShouldRemoveOtherSubviewsWhenPassedViewIsAlreadyASubview: function() { with(this) {
          var testView   = new TestViewWithSubviews(),
              firstView  = testView.get("subviews")[0],
              secondView = testView.get("subviews")[1];

          testView.setView(firstView);

          assertEqual(1, testView.get("subviews").length, "testView should only have 1 subview");
          assert(!secondView.get("superview"), "secondView should not have a superview");
          assert(secondView.get("viewWillDisappearCalled"), "viewWillAppear should have been called on secondView");
          assert(secondView.get("viewDidDisappearCalled"), "viewDidAppear should have been called on secondView");
        }},

        /**
         * Ensures that setting a subview with setView() repositions the
         * subview to fully occupy the superview.
        **/
        testSetViewShouldResetPositioning: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();
          subview.get("element").setStyle({ position: "absolute", left: "100px", top: "100px", right: "100px", bottom: "100px" });
          testView.setView(subview);
          assertEqual("0px", subview.get("element").getStyle("left"), "CSS property 'left' should be 0");
          assertEqual("0px", subview.get("element").getStyle("right"), "CSS property 'right' should be 0");
          assertEqual("0px", subview.get("element").getStyle("top"), "CSS property 'top' should be 0");
          assertEqual("0px", subview.get("element").getStyle("bottom"), "CSS property 'bottom' should be 0");
        }}

      }, { testLog: "logSection" });

    </script>

  </body>
</html>
