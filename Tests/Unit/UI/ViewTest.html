<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="cache-control" content="no-cache" />
    <title>Aphid.UI.View Tests</title>
    <link rel="stylesheet" href="../../../Build/Resources/Stylesheets/Aphid.css" />
    <link rel="stylesheet" href="../../Tests.css" />
    <script src="../../../Build/Library/Aphid.Combined.js"></script>
    <script src="../../../Vendor/script.aculo.us/src/unittest.js"></script>
  </head>
  <body class="testCase">

    <header>
      <h1>Aphid.UI.View Tests</h1>
    </header>

    <!-- Test Case Description -->
    <section id="descriptionSection">
      <p>
        Ensures that the Aphid.UI.View class can be initialized from static
        HTML elements, by asynchronously loading templates and as a result of
        outlets in the document or loaded templates.
      </p>
    </section>

    <!-- Test Elements -->
    <section id="testElements">
      <section id="testElement"></section>
      <section id="testElementWithOutlet">
        <section id="testElementWithOutletTestOutlet" data-outlet="testOutlet"></section>
      </section>
      <section id="testOutlet" data-outlet="testOutlet"></section>
      <section id="testOutletWithOutlet" data-outlet="parentOutlet">
        <section id="testOutletWithOutletChildOutlet" data-outlet="testOutlet"></section>
      </section>
      <section id="testElementWithOutletWithViewClass">
        <section id="testOutletWithViewClass" data-outlet="testOutlet" data-view-class="AnotherTestView"></section>
      </section>
      <section id="testElementWithOutletWithCustomProperties">
        <section id="testOutletWithCustomProperties" data-outlet="testOutlet" data-view-class="TestViewWithProperties" data-custom-property="foo" data-true-property="true" data-false-property="false"></section>
      </section>
      <section id="testElementWithDisabledClassName" class="disabled"></section>
      <section id="testElementWithVisibilityHiddenStyle" style="visibility: hidden"></section>
    </section>

    <!-- Log Section -->
    <section id="logSection">
    </section>

    <!-- Tests -->
    <script>

      var TestView;
      var AnotherTestView;
      var TestViewWithProperties;
      var TestViewWithCallbacks;
      var TestViewWithSubviews;

      new Test.Unit.Runner({

        setup: function() { with(this) {
          $AppDelegate.baseViewPath = "../../Fixtures/Templates";
          TestView = Aphid.Class.create("TestView", Aphid.UI.View, {
            testOutlet: false
          });
          AnotherTestView = Class.create(Aphid.UI.View, {
            displayName: "AnotherTestView"
          });
          TestViewWithProperties = Class.create(Aphid.UI.View, {
            displayName: "TestViewWithProperties",
            customProperty: false,
            trueProperty: false,
            falseProperty: false
          });
          TestViewWithCallbacks = Class.create(Aphid.UI.View, {
            displayName: "TestViewWithCallbacks",

            viewWillAppearCalled: false,
            viewWillAppear: function(animated)
            {
              this.viewWillAppearCalled = true;
            },

            viewDidAppearCalled: false,
            viewDidAppear: function(animated)
            {
              this.viewDidAppearCalled = true;
            },

            viewWillDisappearCalled: false,
            viewWillDisappear: function(animated)
            {
              this.viewWillDisappearCalled = true;
            },

            viewDidDisappearCalled: false,
            viewDidDisappear: function(animated)
            {
              this.viewDidDisappearCalled = true;
            },

            resetCallbacks: function()
            {
              this.viewWillAppearCalled = false;
              this.viewDidAppearCalled = false;
              this.viewWillDisappearCalled = false;
              this.viewDidDisappearCalled = false;
            }

          });
          TestViewWithSubviews = Class.create(TestViewWithCallbacks, {
            displayName: "TestViewWithSubviews",
            viewDidLoad: function($super)
            {
              $super();
              this.addSubview(new TestViewWithCallbacks());
              this.addSubview(new TestViewWithCallbacks());
            }
          });
          TestViewWithEvents = Aphid.Class.create("TestViewWithEvents", Aphid.UI.View, {
            handleFocusEvent: function(event, element) { },
            handleBlurEvent: function(event, element) { },
            handleClickEvent: function(event, element) { },
            handleDoubleClickEvent: function(event, element) { },
            handleMouseDownEvent: function(event, element) { },
            handleMouseUpEvent: function(event, element) { },
            handleMouseMoveEvent: function(event, element) { },
            handleMouseOverEvent: function(event, element) { },
            handleMouseOutEvent: function(event, element) { },
            handleMouseEnterEvent: function(event, element) { },
            handleMouseLeaveEvent: function(event, element) { }
          });
        }},

        /* Initialization Tests ------------------------------------------- */

        /*
         * Ensures that instances of Aphid.UI.View can be initialized and have
         * the expected default property values set after initialization.
        **/
        testShouldInitializeView: function() { with(this) {
          var view = new Aphid.UI.View();
          assertInstanceOf(Aphid.UI.View, view, "view should be an instance of Aphid.UI.View");
          assertInstanceOf(Array, view.subviews, "subviews should be an instance of Array");
          assertInstanceOf(Element, view.element, "element should be an instance of Element");
          assertEqual("section", view.tagName, "tagName should be equal to &quot;section&quot;");
          assert(view.isLoaded, "isLoaded should be false");
          assert(!view.isLoading, "isLoading should be false");
        }},

        /**
         * Ensures that the View's element has the instance of the View stored
         * on the Element instance itself.
        **/
        testShouldStoreViewInstanceOnElement: function() { with(this) {
          var view = new Aphid.UI.View();
          assertInstanceOf(Aphid.UI.View, view.get("element").retrieve("view"));
          assertEqual(view, view.get("element").retrieve("view"));
        }},

        /**
         * Ensures that there is a lazy initializer that will return a default
         * image when accessing the element property.
        **/
        testShouldLazilyInitializeDefaultElementProperty: function() { with(this) {
          var testView = new Aphid.UI.View();
          assertInstanceOf(Element, testView.get("element"), "element property should be lazily initialized");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View with an empty element
         * can be initialized with a custom tag name.
        **/
        testShouldInitializeEmptyViewUsingTagName: function() { with(this) {
          var view = new Aphid.UI.View({ tagName: "ul" });
          assertInstanceOf(Element, view.element, "element should be an instance of Element");
          assertEqual("ul", view.tagName, "tagName should be equal to &quot;ul&quot;");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing an element to the constructor.
        **/
        testShouldInitializeViewFromElement: function() { with(this) {
          var view = new Aphid.UI.View({
            element: $('testElement')
          });
          assertEqual($('testElement'), view.element);
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the name of a template.
        **/
        testShouldInitializeViewFromTemplate: function() { with(this) {
          var view = new Aphid.UI.View({
            template: "TestTemplate"
          });
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
          assert(view.element, "element should not be false");
          assertEqual("testTemplate", view.element.identify());
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the name of a template. The view must load this template
         * asynchronously.
        **/
        testShouldInitializeViewAsynchronouslyFromTemplate: function() { with(this) {
          var view = new Aphid.UI.View({
            template: "TestTemplate",
            asynchronousLoadingEnabled: true
          });
          assert(!view.isLoaded, "isLoaded should be false");
          assert(view.isLoading, "isLoading should be true");
          wait(1000, function() { with(this) {
            assert(view.isLoaded, "isLoaded should be true");
            assert(!view.isLoading, "isLoading should be false");
            assert(view.element, "element should not be false");
            assertEqual("testTemplate", view.element.identify());
          }});
        }},

        /*
         * Ensures that an instance of Aphid.UI.View can be initialized by
         * passing in the element that defines an outlet.
        **/
        testShouldInitializeViewFromOutlet: function() { with(this) {
          var view = new Aphid.UI.View({
            outlet: $('testOutlet')
          });
          assert(view.isLoaded, "isLoaded should be true");
          assert(!view.isLoading, "isLoading should be false");
          assert(view.element, "element should not be false");
          assertEqual($('testOutlet'), view.element);
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized from an element.
        **/
        testShouldInitializeOutletFromElement: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutlet")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
          assertEqual("testElementWithOutletTestOutlet", view.testOutlet.element.identify());
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized from a template that was loaded
         * asynchronously.
        **/
        testShouldInitializeOutletFromTemplate: function() { with(this) {
          var view = new TestView({
            template: "TestTemplateWithOutlet"
          });
          wait(1000, function() { with(this) {
            assert(view.testOutlet, "testOutlet should not be false");
            assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
            assertEqual("testTemplateWithOutletTestOutlet", view.testOutlet.element.identify());
          }});
        }},

        /*
         * Ensures that outlets are initialized when they are found within
         * a view that was initialized as an outlet of a parent view.
        **/
        testShouldInitializeOutletFromOutlet: function() { with(this) {
          var view = new TestView({
            outlet: $("testOutletWithOutlet")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet, "testOutlet should be an instance of Aphid.UI.View");
          assertEqual("testOutletWithOutletChildOutlet", view.testOutlet.element.identify());
        }},

        /*
         * Ensure that views that are initialized from an outlet have their
         * superview property set to the view that owns the outlet.
        **/
        testShouldSetSuperviewOnOutlet: function() { with(this) {
          var view = new TestView({
            outlet: $("testElementWithOutlet")
          });
          assert(view.testOutlet.superview, "testOutlet.superview should not be false");
          assertInstanceOf(Aphid.UI.View, view.testOutlet.superview, "testOutlet.superview should be an instance of Aphid.UI.View");
          assertEqual("testElementWithOutlet", view.testOutlet.superview.element.identify());
        }},

        /*
         * Ensure that views that are initialized from an outlet are added to
         * the subviews property of the view that owns the outlet.
        **/
        testShouldAddOutletToSuperviewsSubviews: function() { with(this) {
          var view = new TestView({
            outlet: $("testElementWithOutlet")
          });
          assertEqual(1, view.subviews.length, "view.subviews.length should be 1");
          assert(view.subviews.include(view.testOutlet));
        }},

        /*
         * Ensures that an outlet the defines the data-view-class attribute
         * for a custom class is actually initialized with the expected class.
        **/
        testShouldInitializeOutletWithViewClass: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithViewClass")
          });
          assert(view.testOutlet, "testOutlet should not be false");
          assertInstanceOf(AnotherTestView, view.testOutlet, "testOutlet should be an instance of AnotherTestView");
        }},

        /*
         * Ensure that views that are initialized from an outlet be
         * initialized with options specified as HTML5 data-* attributes.
        **/
        testShouldSetCustomPropertiesFromOutlet: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithCustomProperties")
          });
          assertEqual("foo", view.testOutlet.customProperty);
        }},

        /*
         * Ensure that views that are initialized from an outlet with boolean
         * HTML5 data-* attributes are properly cast to boolean values.
        **/
        testShouldCastCustomBooleanPropertiesFromOutlet: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithOutletWithCustomProperties")
          });
          assertEqual(true, view.testOutlet.trueProperty);
          assertEqual(false, view.testOutlet.falseProperty);
        }},

        /*
         * Ensure that newly initialized views are enabled, by default.
        **/
        testShouldInitializeEnabledByDefault: function() { with(this) {
          var view = new TestView({
            element: $("testElement")
          });
          assert(view.isEnabled, "view#isEnabled should be true");
          assert(!view.element.hasClassName("disabled"), "view#element should not have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that views can be initialized in a disabled state.
        **/
        testShouldInitializeDisabled: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: false
          });
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that views that are initialized with an element that has the
         * "disabled" CSS class name are initialized in a disabled state.
        **/
        testShouldInitializeDisabledFromDisabledCSSClass: function() { with(this) {
          var view = new TestView({
            element: $("testElementWithDisabledClassName")
          });
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that disabled views can be enabled and that the element
         * receives the "enabled" CSS class name upon enabling.
        **/
        testShouldEnableView: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: false
          });
          view.enable();
          assert(view.isEnabled, "view#isEnabled should be true");
          assert(!view.element.hasClassName("disabled"), "view#element should not have the CSS class name 'disabled'");
        }},

        /*
         * Ensure that enabled views can be disabled and that the element
         * receives the "disabled" CSS class name upon disabling.
        **/
        testShouldDisableView: function() { with(this) {
          var view = new TestView({
            element: $("testElement"),
            isEnabled: true
          });
          view.disable();
          assert(!view.isEnabled, "view#isEnabled should be false");
          assert(view.element.hasClassName("disabled"), "view#element should have the CSS class name 'disabled'");
        }},


        /**
         * Ensure that newly initialized views are not hidden, by default.
        **/
        testShouldInitializeVisibleByDefault: function() { with(this) {
          var view = new Aphid.UI.View();
          assert(!view.get("hidden"), "view#hidden should be false");
          assertEqual("visible", view.get("element").getStyle("visibility"), "view#element should have its 'visibility' CSS style set to 'visible'");
        }},

        /**
         * Ensure that views can be initialized in a hidden state.
        **/
        testShouldInitializeHidden: function() { with(this) {
          var view = new Aphid.UI.View({ hidden: true });
          assert(view.get("hidden"), "view#hidden should be true");
          assertEqual("hidden", view.get("element").getStyle("visibility"), "view#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that views that are initialized with an element that has the
         * "visibility" CSS style set to "hidden" are initialized in a hidden
         * state.
        **/
        testShouldInitializeHiddenFromVisibilityCSSStyle: function() { with(this) {
          var view = new TestView({ element: $("testElementWithVisibilityHiddenStyle") });
          assert(view.get("hidden"), "view#hidden should be true");
          assertEqual("hidden", view.get("element").getStyle("visibility"), "view#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that a view can be hidden by setting the hidden property
         * to true.
        **/
        testShouldHideWhenSettingHiddenPropertyToTrue: function() { with(this) {
          var view = new Aphid.UI.View();

          view.set("hidden", true);
          assert(view.get("hidden"), "view#hidden should be true");
          assertEqual("hidden", view.get("element").getStyle("visibility"), "view#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that a view can be displayed by setting the hidden property
         * to false.
        **/
        testShouldMakeVisibleWhenSettingHiddenPropertyToFalse: function() { with(this) {
          var view = new Aphid.UI.View({ hidden: true });

          view.set("hidden", false);
          assert(!view.get("hidden"), "view#hidden should be false");
          assertEqual("visible", view.get("element").getStyle("visibility"), "view#element should have its 'visibility' CSS style set to 'visible'");
        }},

        /* View Stack Tests ----------------------------------------------- */

        /**
         * Ensure that views may have their view set with a single subview
         * using the setView method.
        **/
        testShouldSetView: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.setView(subview);
          assertEqual(1, testView.get("subviews").size(), "testView#subviews should have a size of 1");
          assertEqual(testView.get("subviews").first(), subview, "testView#subviews should include subview");
          assertEqual(testView, subview.get("superview"), "subview#superview should be equal to testView");
        }},

        /**
         * Ensure that hidden views are not displayed when added to a view
         * using the setView method.
        **/
        testShouldSetViewWithHiddenView: function() { with(this) {
          var testView = new TestView(),
              subview  = new Aphid.UI.View({ hidden: true });

          testView.setView(subview);
          assert(subview.get("hidden"), "subview should be hidden");
          assertEqual("hidden", subview.get("element").getStyle("visibility"), "subview#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that views may have their view set with a single subview
         * using the setViewAnimated method.
        **/
        testShouldSetViewAnimated: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.setViewAnimated(subview);
          assertEqual(1, testView.get("subviews").size(), "testView#subviews should have a size of 1");
          assertEqual(testView.get("subviews").first(), subview, "testView#subviews should include subview");
          assertEqual(testView, subview.get("superview"), "subview#superview should be equal to testView");
        }},

        /**
         * Ensure that hidden views are not displayed when added to a view
         * using the setViewAnimated method.
        **/
        testShouldSetViewAnimatedWithHiddenView: function() { with(this) {
          var testView = new TestView(),
              subview  = new Aphid.UI.View({ hidden: true });

          testView.setViewAnimated(subview);
          assert(subview.get("hidden"), "subview should be hidden");
          assertEqual("hidden", subview.get("element").getStyle("visibility"), "subview#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that subviews may be added to a view using the addSubview
         * method.
        **/
        testShouldAddSubview: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.addSubview(subview);
          assertEqual(1, testView.get("subviews").size(), "testView#subviews should have a size of 1");
          assertEqual(testView.get("subviews").first(), subview, "testView#subviews should include subview");
          assertEqual(testView, subview.get("superview"), "subview#superview should be equal to testView");
        }},

        /**
         * Ensure that hidden subviews are not displayed when added to a view
         * using the addSubview method.
        **/
        testShouldAddSubviewWithHiddenView: function() { with(this) {
          var testView = new TestView(),
              subview  = new Aphid.UI.View({ hidden: true });

          testView.addSubview(subview);
          assert(subview.get("hidden"), "subview should be hidden");
          assertEqual("hidden", subview.get("element").getStyle("visibility"), "subview#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that subviews may be added to a view using the
         * addSubviewAnimated method.
        **/
        testShouldAddSubviewAnimated: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();

          testView.addSubviewAnimated(subview);
          assertEqual(1, testView.get("subviews").length, "testView#subviews should have a length of 1");
          assertEqual(testView.get("subviews").first(), subview, "testView#subviews should include subview");
          assertEqual(testView, subview.get("superview"), "subview#superview should be equal to testView");
        }},

        /**
         * Ensure that hidden subviews are not displayed when added to a view
         * using the addSubviewAnimated method.
        **/
        testShouldAddSubviewAnimatedWithHiddenView: function() { with(this) {
          var testView = new TestView(),
              subview  = new Aphid.UI.View({ hidden: true });

          testView.addSubviewAnimated(subview);
          assert(subview.get("hidden"), "subview should be hidden");
          assertEqual("hidden", subview.get("element").getStyle("visibility"), "subview#element should have its 'visibility' CSS style set to 'hidden'");
        }},

        /**
         * Ensure that subviews may be removed from their superview by calling
         * the removeFromSuperview() method on the view to be removed.
        **/
        testShouldRemoveFromSuperview: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          firstSubview.removeFromSuperview();
          secondSubview.removeFromSuperview();
          assert(!firstSubview.get("superview"));
          assert(!secondSubview.get("superview"));
          assertEqual(0, testView.subviews, "testView#subviews should have no subviews");
        }},

        /**
         * Ensure that subviews may be removed from their superview by calling
         * the removeFromSuperviewAnimated() method on the view to be removed.
        **/
        testShouldRemoveFromSuperviewAnimated: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          firstSubview.removeFromSuperviewAnimated();
          secondSubview.removeFromSuperviewAnimated();
          assert(!firstSubview.get("superview"), "firstSubview should not have a superview");
          assert(!secondSubview.get("superview"), "secondSubview should not have a superview");
          assertEqual(0, testView.subviews, "testView#subviews should have no subviews");
        }},

        /**
         * Ensure that all subviews on a view may be removed at once by
         * calling the clearSubviews() method.
        **/
        testShouldClearSubviews: function() { with(this) {
          var testView = new TestViewWithSubviews();
          assertEqual(2, testView.subviews.length, "testView#subviews should have 2 subviews");
          testView.clearSubviews();
          assertEqual(0, testView.subviews.length);
        }},

        /**
         * Ensure that the "superviews" property on a view returns all of its
         * superviews in the view stack. The superviews should be returned in
         * order from the most immediate (at index 0) to the least immediate
         * superview.
        **/
        testShouldReturnSuperviews: function() { with(this) {
          var topView    = new Aphid.UI.View(),
              middleView = new Aphid.UI.View(),
              bottomView = new Aphid.UI.View();

          topView.addSubview(middleView);
          middleView.addSubview(bottomView);

          assertEqual(2, bottomView.get("superviews").size(), "bottomView#superviews should contain 2 entries");
          assertEqual(middleView, bottomView.get("superviews")[0], "the superview at index 0 should be middleView");
          assertEqual(topView, bottomView.get("superviews")[1], "the superview at index 1 should be topView");
        }},

        // Action Tests ------------------------------------------------------

        // TODO Implement Action Tests...

        // Callback Tests ----------------------------------------------------

        /**
         * Ensure that setting the view with setView() will call the
         * viewWillAppear callback when the superview is visible.
        **/
        testSetViewShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.setView(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with setView");
          subview.viewWillAppearCalled = false;

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setView() will not call the
         * viewWillAppear callback if the superview is not visible.
        **/
        // testSetViewShouldNotCallViewWillAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView(),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setView(subview);
        //   assert(!subview.viewWillAppearCalled, "viewWillAppear should not be called on the view when adding to a hidden view with setView");
        // }},

        /**
         * Ensure that setting the view with setViewAnimated() will call the
         * viewWillAppear callback when the superview is visible.
        **/
        testSetViewAnimatedShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.setViewAnimated(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with setViewAnimated");
          subview.viewWillAppearCalled = false;

          testView.removeFromSuperview();
        }},

        /**
        * Ensure that setting the view with setViewAnimated() will not call
        * the viewWillAppear callback if the superview is not visible.
        **/
        // testSetViewAnimatedShouldNotCallViewWillAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView(),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setViewAnimated(subview);
        //   assert(!subview.viewWillAppearCalled, "viewWillAppear should not be called on the view when adding to a hidden view with setView");
        //   subview.viewWillAppearCalled = false;
        // }},

        /**
         * Ensure that adding a view width addSubview() will call the
         * viewWillAppear callback when the superview is visible.
        **/
        testAddSubviewShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubview(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with addSubview");
          subview.viewWillAppearCalled = false;

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view width addSubview() will not call the
         * viewWillAppear callback if the superview is not visible.
        **/
        // testAddSubviewShouldNotCallViewWillAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView(),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.addSubview(subview);
        //   assert(!subview.viewWillAppearCalled, "viewWillAppear should not be called on the view when adding to another view with addSubview");
        //   subview.viewWillAppearCalled = false;
        // }},

        /**
         * Ensure that adding a view width addSubviewAnimated() will call the
         * viewWillAppear callback when the superview is visible.
        **/
        testAddSubviewAnimatedShouldCallViewWillAppearCallback: function() { with(this) {
          var testView = new TestView(),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubviewAnimated(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should be called on the view when adding to another view with addSubviewAnimated");
          subview.viewWillAppearCalled = false;

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view width addSubviewAnimated() will not call
         * the viewWillAppear callback if the superview is not visible.
        **/
        // testAddSubviewAnimatedShouldNotCallViewWillAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView(),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.addSubviewAnimated(subview);
        //   assert(!subview.viewWillAppearCalled, "viewWillAppear should not be called on the view when adding to another view with addSubviewAnimated");
        //   subview.viewWillAppearCalled = false;
        // }},

        /**
         * Ensure that setting the view with setView() will call the
         * viewWillAppear callback on each of the subviews on the view that
         * is to be set, if the superview is visible.
        **/
        testSetViewShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setView(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setView");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setView() will not call the
         * viewWillAppear callback on each of the subviews on the view that
         * is to be set, if the superview is not visible.
        **/
        // testSetViewShouldNotCallViewWillAppearCallbackOnSubviewsWhenSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setView(subview);
        //   assert(!subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with setView");
        //   assert(!subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with setView");
        // }},

        /**
         * Ensure that setting the view with setViewAnimated() will call the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be set, if the superview is visible.
        **/
        testSetViewAnimatedShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setViewAnimated(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setViewAnimated");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with setViewAnimated");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setViewAnimated() will not call
         * the viewWillAppear callback on each of the subviews on the view
         * that is to be set, if the superview is not visible.
        **/
        // testSetViewAnimatedShouldNotCallViewWillAppearCallbackOnSubviewsWhenSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setViewAnimated(subview);
        //   assert(!subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with setViewAnimated");
        //   assert(!subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with setViewAnimated");
        // }},

        /**
         * Ensure that adding a view with addSubview() will call the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testAddSubviewShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.addSubview(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubview");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubview");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view with addSubview() will not call the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added, if the superview is not visible.
        **/
        // testAddSubviewShouldNotCallViewWillAppearCallbackOnSubviewsIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.addSubview(subview);
        //   assert(!subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with addSubview");
        //   assert(!subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should not be called on the view's subviews when adding to another view with addSubview");
        // }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will call the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testAddSubviewAnimatedShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.addSubviewAnimated(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will not call the
         * viewWillAppear callback on each of the subviews on the view that is
         * to be added, if the superview is not visible.
        **/
        testAddSubviewAnimatedShouldCallViewWillAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.addSubviewAnimated(subview);
          assert(subview.get("subviews")[0].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
          assert(subview.get("subviews")[1].viewWillAppearCalled, "viewWillAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
        }},

        /**
         * Ensure that setting the view with setView() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        testSetViewShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setView(subview);
          assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with setView");
          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setView() will not call the
         * viewDidAppear callback if the superview is not visible.
        **/
        // testSetViewShouldNotCallViewDidAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setView(subview);
        //   assert(!subview.viewDidAppearCalled, "viewDidAppear should not be called on the view when adding to another view with setView");
        // }},

        /**
         * Ensure that setting the view with setViewAnimated() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        testSetViewAnimatedShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setViewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with setViewAnimated");
          }});

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setViewAnimated() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        // testSetViewAnimatedShouldNotCallViewDidAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setViewAnimated(subview);
        //   wait(2000, function() { with(this) {
        //     assert(!subview.viewDidAppearCalled, "viewDidAppear should not be called on the view when adding to another view with setViewAnimated");
        //   }});
        // }},

        /**
         * Ensure that adding a view width addSubview() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        testAddSubviewShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubview(subview);
          assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with addSubview");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view width addSubview() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        // testAddSubviewShouldNotCallViewDidAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be true");
        //   testView.addSubview(subview);
        //   assert(!subview.viewDidAppearCalled, "viewDidAppear should not be called on the view when adding to another view with addSubview");
        // }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will call the
         * viewDidAppear callback when the superview is visible.
        **/
        testAddSubviewAnimatedShouldCallViewDidAppearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubviewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.viewDidAppearCalled, "viewDidAppear should be called on the view when adding to another view with addSubviewAnimated");
          }});

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will not call
         * the viewDidAppear callback if the superview is not visible.
        **/
        // testAddSubviewAnimatedShouldNotCallViewDidAppearCallbackIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithCallbacks();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.addSubviewAnimated(subview);
        //   wait(2000, function() { with(this) {
        //     assert(!subview.viewDidAppearCalled, "viewDidAppear should not be called on the view when adding to another view with addSubviewAnimated");
        //   }});
        // }},

        /**
         * Ensure that setting the view with setView() will call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testSetViewShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.setView(subview);
          assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setView");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setView() will not call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is not visible.
        **/
        // testSetViewShouldNotCallViewDidAppearCallbackOnSubviewsIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.setView(subview);
        //   assert(!subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with setView");
        //   assert(!subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with setView");
        // }},

        /**
         * Ensure that setting the view with setViewAnimated() will call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testSetViewAnimatedShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setViewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that setting the view with setViewAnimated() will not call
         * the viewDidAppear callback on each of the subviews on the view that
         * is to be added, if the superview is not visible.
        **/
        testSetViewAnimatedShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.setViewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        /**
         * Ensure that adding a view with addSubview() will call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testAddSubviewShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubview(subview);
          assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubview");
          assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubview");

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view with addSubview() will not call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is not visible.
        **/
        // testAddSubviewShouldNotCallViewDidAppearCallbackOnSubviewsIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("visible"), "visible on testView should be false");
        //   testView.addSubview(subview);
        //   assert(!subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with addSubview");
        //   assert(!subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with addSubview");
        // }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will call the
         * viewDidAppear callback on each of the subviews on the view that is
         * to be added, if the superview is visible.
        **/
        testAddSubviewAnimatedShouldCallViewDidAppearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible on testView should be true");

          testView.addSubviewAnimated(subview);
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
            assert(subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should be called on the view's subviews when adding to another view with addSubviewAnimated");
          }});

          testView.removeFromSuperview();
        }},

        /**
         * Ensure that adding a view with addSubviewAnimated() will not call
         * the viewDidAppear callback on each of the subviews on the view that
         * is to be added, if the superview is not visible.
        **/
        // testAddSubviewAnimatedShouldNotCallViewDidAppearCallbackOnSubviewsIfSuperviewIsNotVisible: function() { with(this) {
        //   var testView = new TestView({ element: $('testElement')}),
        //       subview  = new TestViewWithSubviews();

        //   assert(!testView.get("isVisible"), "isVisible on testView should be false");
        //   testView.addSubviewAnimated(subview);
        //   wait(2000, function() { with(this) {
        //     assert(!subview.get("subviews")[0].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with addSubviewAnimated");
        //     assert(!subview.get("subviews")[1].viewDidAppearCalled, "viewDidAppear should not be called on the view's subviews when adding to another view with addSubviewAnimated");
        //   }});

        //   testView.removeFromSuperview();
        // }},

        testSetViewShouldCallViewWillDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setView();
          assert(subview.viewWillDisappearCalled, "viewWillDisappear should be called on the view when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewWillDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setViewAnimated(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.viewWillDisappearCalled, "viewWillDisappear should be called on the view when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewWillDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setView();
          assert(subview.get("subviews")[0].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewWillDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewWillDisappearCalled, "viewWillDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewDidDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setView();
          assert(subview.viewDidDisappearCalled, "viewDidDisappear should be called on the view when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewDidDisappearCallback: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithCallbacks();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.viewDidDisappearCalled, "viewDidDisappear should be called on the view when adding to another view with setViewAnimated");
          }});
        }},

        testSetViewShouldCallViewDidDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setView();
          assert(subview.get("subviews")[0].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setView");
          assert(subview.get("subviews")[1].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setView");
        }},

        testSetViewAnimatedShouldCallViewDidDisappearCallbackOnSubviews: function() { with(this) {
          var testView = new TestView({ element: $('testElement')}),
              subview  = new TestViewWithSubviews();

          testView.setView(subview);
          testView.setViewAnimated();
          wait(2000, function() { with(this) {
            assert(subview.get("subviews")[0].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
            assert(subview.get("subviews")[1].viewDidDisappearCalled, "viewDidDisappear should be called on the view's subviews when adding to another view with setViewAnimated");
          }});
        }},

        /**
         * Ensure that when setting a subview with setView() that the subview
         * is not removed from the superview if the subview is already a
         * subview of the superview.
        **/
        testSetViewShouldNotAttemptToSetViewIfAlreadyASubview: function() { with(this) {
          var testView   = new TestViewWithSubviews(),
              firstView  = testView.get("subviews")[0],
              secondView = testView.get("subviews")[1];

          firstView.resetCallbacks();

          testView.setView(firstView);

          assert(!firstView.get("viewWillAppearCalled"), "viewWillAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidAppearCalled"), "viewDidAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewWillDisappearCalled"), "viewWillDisappear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidDisappearCalled"), "viewDidDisappear should not have been called on firstView, since it was already a subview of testView");
        }},

        /**
         * Ensure that when adding a subview with addSubview() that the
         * subview is not removed from the superview if the subview is already
         * a subview of the superview.
        **/
        testSetViewShouldNotAttemptToAddViewIfAlreadyASubview: function() { with(this) {
          var testView   = new TestViewWithSubviews(),
              firstView  = testView.get("subviews")[0],
              secondView = testView.get("subviews")[1];

          firstView.resetCallbacks();
          secondView.resetCallbacks();

          testView.addSubview(firstView);

          assertEqual(2, testView.subviews.length, "testView should have 2 subviews");
          assert(!firstView.get("viewWillAppearCalled"), "viewWillAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidAppearCalled"), "viewDidAppear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewWillDisappearCalled"), "viewWillDisappear should not have been called on firstView, since it was already a subview of testView");
          assert(!firstView.get("viewDidDisappearCalled"), "viewDidDisappear should not have been called on firstView, since it was already a subview of testView");
          assert(!secondView.get("viewWillAppearCalled"), "viewWillAppear should not have been called on secondView");
          assert(!secondView.get("viewDidAppearCalled"), "viewDidAppear should not have been called on secondView");
          assert(!secondView.get("viewWillDisappearCalled"), "viewWillDisappear should not have been called on secondView");
          assert(!secondView.get("viewDidDisappearCalled"), "viewDidDisappear should not have been called on secondView");
        }},

        /**
         * Ensure that when setting a subview with setView() that the subview
         * is not removed from the superview if the subview is already a
         * subview of the superview.
        **/
        testSetViewShouldRemoveOtherSubviewsWhenPassedViewIsAlreadyASubview: function() { with(this) {
          var testView   = new TestViewWithSubviews(),
              firstView  = testView.get("subviews")[0],
              secondView = testView.get("subviews")[1];

          testView.setView(firstView);

          assertEqual(1, testView.get("subviews").length, "testView should only have 1 subview");
          assert(!secondView.get("superview"), "secondView should not have a superview");
          assert(secondView.get("viewWillDisappearCalled"), "viewWillAppear should have been called on secondView");
          assert(secondView.get("viewDidDisappearCalled"), "viewDidAppear should have been called on secondView");
        }},

        /**
         * Ensures that setting a subview with setView() repositions the
         * subview to fully occupy the superview.
        **/
        testSetViewShouldResetPositioning: function() { with(this) {
          var testView = new TestView(),
              subview  = new AnotherTestView();
          subview.get("element").setStyle({ position: "absolute", left: "100px", top: "100px", right: "100px", bottom: "100px" });
          testView.setView(subview);
          assertEqual("0px", subview.get("element").getStyle("left"), "CSS property 'left' should be 0");
          assertEqual("0px", subview.get("element").getStyle("right"), "CSS property 'right' should be 0");
          assertEqual("0px", subview.get("element").getStyle("top"), "CSS property 'top' should be 0");
          assertEqual("0px", subview.get("element").getStyle("bottom"), "CSS property 'bottom' should be 0");
        }},

        testShouldCallViewWillAppearOnlyOnce: function() { with(this) {
          var testView = new TestViewWithCallbacks(),
              subview  = new TestViewWithCallbacks();

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(testView.viewWillAppearCalled, "viewWillAppear should have been called on testView");
          testView.resetCallbacks();

          // Add Subview
          testView.addSubview(subview);
          assert(subview.viewWillAppearCalled, "viewWillAppear should have been called on subview");
          assert(!testView.viewWillAppearCalled, "viewWillAppear should NOT have been called on testView");
        }},

        testShouldCallViewDidAppearOnlyOnce: function() { with(this) {
          var testView = new TestViewWithCallbacks(),
              subview  = new TestViewWithCallbacks();

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(testView.viewDidAppearCalled, "viewDidAppear should have been called on testView");
          testView.resetCallbacks();

          // Add Subview
          testView.addSubview(subview);
          assert(subview.viewDidAppearCalled, "viewDidAppear should have been called on subview");
          assert(!testView.viewDidAppearCalled, "viewDidAppear should NOT have been called on testView");
        }},

        testShouldResetViewWillAppearCalledStateWhenViewDidDisappearIsCalled: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(testView.viewWillAppearCalled, "viewWillAppear should have been called on testView");
          assert(firstSubview.viewWillAppearCalled, "viewWillAppear should have been called on firstSubview");
          assert(secondSubview.viewWillAppearCalled, "viewWillAppear should have been called on secondSubview");

          // Remove Subviews
          firstSubview.removeFromSuperview();
          secondSubview.removeFromSuperview();
          assert(!firstSubview._viewWillAppearCalled, "_viewWillAppearCalled should be false on firstSubview");
          assert(!secondSubview._viewWillAppearCalled, "_viewWillAppearCalled should be false on secondSubview");
          assert(testView._viewWillAppearCalled, "_viewWillAppearCalled should be true on testView");
        }},

        testShouldResetViewDidAppearCalledStateWhenViewDidDisappearIsCalled: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(testView.viewDidAppearCalled, "viewDidAppear should have been called on testView");
          assert(firstSubview.viewDidAppearCalled, "viewDidAppear should have been called on firstSubview");
          assert(secondSubview.viewDidAppearCalled, "viewDidAppear should have been called on secondSubview");

          // Remove Subviews
          firstSubview.removeFromSuperview();
          secondSubview.removeFromSuperview();
          assert(!firstSubview._viewDidAppearCalled, "_viewDidAppearCalled should be false on firstSubview");
          assert(!secondSubview._viewDidAppearCalled, "_viewDidAppearCalled should be false on secondSubview");
          assert(testView._viewDidAppearCalled, "_viewDidAppearCalled should be true on testView");
        }},

        testShouldResetViewWillDisappearCalledStateWhenViewWillAppearIsCalled: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);

          // Remove the Test View
          testView.removeFromSuperview();
          assert(testView.viewWillDisappearCalled, "viewWillDisappear should have been called on testView");
          assert(firstSubview.viewWillDisappearCalled, "viewWillDisappear should have been called on firstSubview");
          assert(secondSubview.viewWillDisappearCalled, "viewWillDisappear should have been called on secondSubview");

          // Re-Display the Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(!firstSubview._viewWillDisappearCalled, "_viewWillDisappearCalled should be false on firstSubview");
          assert(!secondSubview._viewWillDisappearCalled, "_viewWillDisappearCalled should be false on secondSubview");
          assert(!testView._viewWillDisappearCalled, "_viewWillDisappearCalled should be false on testView");
        }},

        testShouldResetViewDidDisappearCalledStateWhenViewDidAppearIsCalled: function() { with(this) {
          var testView      = new TestViewWithSubviews(),
              firstSubview  = testView.get("subviews")[0],
              secondSubview = testView.get("subviews")[1];

          // Display Test View
          $AppDelegate.mainWindow.addSubview(testView);

          // Remove the Test View
          testView.removeFromSuperview();
          assert(testView.viewDidDisappearCalled, "viewDidDisappear should have been called on testView");
          assert(firstSubview.viewDidDisappearCalled, "viewDidDisappear should have been called on firstSubview");
          assert(secondSubview.viewDidDisappearCalled, "viewDidDisappear should have been called on secondSubview");

          // Re-Display the Test View
          $AppDelegate.mainWindow.addSubview(testView);
          assert(!firstSubview._viewDidDisappearCalled, "_viewDidDisappearCalled should be false on firstSubview");
          assert(!secondSubview._viewDidDisappearCalled, "_viewDidDisappearCalled should be false on secondSubview");
          assert(!testView._viewDidDisappearCalled, "_viewDidDisappearCalled should be false on testView");
        }},

        // Event Observer Tests ----------------------------------------------

        testShouldAddObserverForFocusEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleFocusEventListener));
        }},

        testShouldAddObserverForBlurEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleBlurEventListener));
        }},

        testShouldAddObserverForClickEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleClickEventListener));
        }},

        testShouldAddObserverForDoubleClickEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleDoubleClickEventListener));
        }},

        testShouldAddObserverForMouseDownEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseDownEventListener));
        }},

        testShouldAddObserverForMouseUpEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseUpEventListener));
        }},

        testShouldAddObserverForMouseOverEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseOverEventListener));
        }},

        testShouldAddObserverForMouseOutEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseOutEventListener));
        }},

        testShouldAddObserverForMouseEnterEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseEnterEventListener));
        }},

        testShouldAddObserverForMouseLeaveEvents: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          assert(Object.isFunction(testView._handleMouseLeaveEventListener));
        }},

        testShouldStopObservingEventsWhenDisabled: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          testView.disable();
          assert(!testView._handleFocusEventListener);
          assert(!testView._handleBlurEventListener);
          assert(!testView._handleClickEventListener);
          assert(!testView._handleDoubleClickEventListener);
          assert(!testView._handleMouseDownEventListener);
          assert(!testView._handleMouseUpEventListener);
          assert(!testView._handleMouseOverEventListener);
          assert(!testView._handleMouseOutEventListener);
          assert(!testView._handleMouseEnterEventListener);
          assert(!testView._handleMouseLeaveEventListener);
        }},

        testShouldStartObservingEventsWhenEnabled: function() { with(this) {
          var testView = new TestViewWithEvents();
          testView._startObserving();
          testView.disable();
          testView.enable();
          assert(Object.isFunction(testView._handleFocusEventListener));
          assert(Object.isFunction(testView._handleBlurEventListener));
          assert(Object.isFunction(testView._handleClickEventListener));
          assert(Object.isFunction(testView._handleDoubleClickEventListener));
          assert(Object.isFunction(testView._handleMouseDownEventListener));
          assert(Object.isFunction(testView._handleMouseUpEventListener));
          assert(Object.isFunction(testView._handleMouseOverEventListener));
          assert(Object.isFunction(testView._handleMouseOutEventListener));
          assert(Object.isFunction(testView._handleMouseEnterEventListener));
          assert(Object.isFunction(testView._handleMouseLeaveEventListener));
        }},

        testShouldNotStartObservingForEventsWhenInitializedDisabled: function() { with(this) {
          var testView = new TestViewWithEvents({ element: $('testElementWithDisabledClassName') });
          $AppDelegate.mainWindow.addSubview(testView);
          assert(!testView._handleFocusEventListener);
          assert(!testView._handleBlurEventListener);
          assert(!testView._handleClickEventListener);
          assert(!testView._handleDoubleClickEventListener);
          assert(!testView._handleMouseDownEventListener);
          assert(!testView._handleMouseUpEventListener);
          assert(!testView._handleMouseOverEventListener);
          assert(!testView._handleMouseOutEventListener);
          assert(!testView._handleMouseEnterEventListener);
          assert(!testView._handleMouseLeaveEventListener);
        }},

        // Hide / Show -------------------------------------------------------

        testShouldHideView: function() { with(this) {
          var testView = new Aphid.UI.View();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible should be true on testView");

          testView.hide();
          assert(!testView.get("visible"), "visible should be false on testView");
        }},

        testShouldHideViewAnimated: function() { with(this) {
          var testView = new Aphid.UI.View();

          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "visible should be true on testView");

          testView.hideAnimated();
          wait(1000, function() {
            assert(!testView.get("visible"), "visible should be false on testView");
          });
        }},

        testShouldShowView: function() { with(this) {
          var testView = new Aphid.UI.View({ hidden: true });
          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.show();
          assert(testView.get("visible"), "visible should be true on testView");
        }},

        testShouldShowViewAnimated: function() { with(this) {
          var testView = new Aphid.UI.View({ hidden: true });
          $AppDelegate.get("mainWindow").addSubview(testView);
          testView.showAnimated();
          wait(1000, function() {
            assert(testView.get("visible"), "visible should be true on testView");
          });
        }},

        testVisiblePropertyShouldBeTrueWhenViewIsVisible: function() { with(this) {
          var testView = new Aphid.UI.View();
          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(testView.get("visible"), "testView should be visible");
        }},

        testVisiblePropertyShouldBeFalseWhenViewIsNotVisible: function() { with(this) {
          var testView = new Aphid.UI.View({ visible: false });
          $AppDelegate.get("mainWindow").addSubview(testView);
          assert(!testView.get("visible"), "testView should not be visible");
        }},

        testVisiblePropertyShouldBeFalseWhenSuperviewIsNotVisible: function() { with(this) {
          var superview = new Aphid.UI.View(),
              testView  = new Aphid.UI.View();

          $AppDelegate.get("mainWindow").addSubview(superview);
          superview.addSubview(testView);
          superview.set("hidden", true);
          assert(!testView.get("visible"), "testView should not be visible");
        }}

      }, { testLog: "logSection" });

    </script>

  </body>
</html>
